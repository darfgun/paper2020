?str_extract
string = "SEX BY AGE (WHITE ALONE)"
b<-str_extract(string, "\(.*)")
string = "SEX BY AGE (WHITE ALONE)"
b<-str_extract(string, "(.*)")
b
string = "SEX BY AGE (WHITE ALONE)"
b<-str_extract(string, "\\(.*)")
string = "SEX BY AGE (WHITE ALONE)"
b<-str_extract(string, "W.*)")
string = "SEX BY AGE (WHITE ALONE)"
b<-str_extract(string, "W.*")
b
b<-str_extract(string, "[:cntrl:]W.*")
b
regmatches(string, gregexpr("(?<=\\().*?(?=\\))", string, perl=T))[[1]]
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
origin = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]],
concept = NULL)
a<-regmatches(string, gregexpr("(?<=\\().*?(?=\\))", string, perl=T))[[1]]
a
strsplit(a,",")
string = "SEX BY AGE (WHITE ALONE, Hispanic)"
a<-regmatches(string, gregexpr("(?<=\\().*?(?=\\))", string, perl=T))[[1]]
a
strsplit(a,",")
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = c("PCT12A","PCT12L")) %>% select('name','label','concept')
s
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = c("PCT12L")) %>% select('name','label','concept')
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL) %>%
mutate(race)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL) %>%
mutate(race =race_his[1],
hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[2]),
race_his = NULL)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL) %>%
mutate(race =race_his[[1]],
hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[[2]]),
race_his = NULL)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL) %>%
mutate(race =race_his[[1]],
hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[2]),
race_his = NULL)
string = "SEX BY AGE (WHITE ALONE, Hispanic)"
a<-regmatches(string, gregexpr("(?<=\\().*?(?=\\))", string, perl=T))[[1]]
a
strsplit(a,",")
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = (regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","))[1],
concept = NULL) %>%
mutate(race =race_his[1],
hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[2]),
race_his = NULL)
strsplit(a,",")[[1]]
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = (regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","))[[1]],
concept = NULL) %>%
mutate(race =race_his[1],
hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[2]),
race_his = NULL)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = (regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","))[[1]],
concept = NULL) %>%
mutate(race =race_his[1],
hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[2]),
race_his = NULL)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL) #%>%
a<-regmatches(string, gregexpr("(?<=\\().*?(?=\\))", string, perl=T))[[1]]
a
strsplit(a,",")[[1]]
string = "SEX BY AGE (WHITE ALONE, Hispanic)"
a<-regmatches(string, gregexpr("(?<=\\().*?(?=\\))", string, perl=T))[[1]]
a<-strsplit(a,",")
b<-a[[1]]
a
b
class(a)
class(b)
?unlist
b<-unlist(a)
class(b)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") %>% unlist,
concept = NULL) #%>%
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") #%>% unlist
,
concept = NULL) #%>%
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") ,
concept = NULL) #%>%
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") ,
concept = NULL) %>%
mutate(race =race_his[[1]][1],
#       hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[2]),
#       race_his = NULL
)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") ,
concept = NULL) %>%
mutate(race = race_his[[1]][1],
hispanic_origin = ifelse(length(race_his[[1]]) == 1, "all", race_his[[1]][2]),
race_his = NULL
)
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = c("PCT12A")) %>% select('name','label','concept')
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") ,
concept = NULL) %>%
mutate(race = race_his[[1]][1],
hispanic_origin = ifelse(length(race_his[[1]]) == 1, "all", race_his[[1]][2]),
race_his = NULL
)
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = c("PCT12A")
) %>%
select('name','label','concept') %>%
mutate(
gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>%
as.numeric,
max_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")
%>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL,
race = race_his[[1]][1],
hispanic_origin = ifelse(length(race_his[[1]]) == 1, "all", race_his[[1]][2]),
race_his = NULL)
View(census_vars)
rm(list=ls(all=TRUE))
# load packages, install if missing
packages <- c("dplyr","magrittr", "censusapi","tidyr","tidyverse","stringr")
options(tigris_use_cache = FALSE)
for(p in packages){
if(p %in% rownames(installed.packages())==FALSE){
install.packages(p)
}
suppressMessages(library(p, character.only = T, warn.conflicts=FALSE))
}
# Add key to .Renviron
key <- "d44ca9c0b07372ada0b5243518e89adcc06651ef" #TODO
Sys.setenv(CENSUS_KEY=key)
#census api
year <-2010 #TODO delete
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = c("PCT12A")
) %>%
select('name','label','concept') %>%
mutate(
gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>%
as.numeric,
max_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")
%>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL,
race = race_his[[1]][1],
hispanic_origin = ifelse(length(race_his[[1]]) == 1, "all", race_his[[1]][2]),
race_his = NULL)
data_from_api <- getCensus(name = "dec/sf1",
vintage = 2010,
vars  = c("PCT012A164","PCT012A165"),
region = "tract:*",
regionin = "state:17") %>% #TODO testzwecke
pivot_longer( cols=!(1:3), names_to = "variable", values_to = "value")
merge(data_from_api, census_vars)
join<-merge(data_from_api, census_vars)
View(join)
setnames(DF, "name", "variable")
# load packages, install if missing
packages <- c("dplyr","magrittr", "censusapi","tidyr","tidyverse","stringr","data.table")
options(tigris_use_cache = FALSE)
for(p in packages){
if(p %in% rownames(installed.packages())==FALSE){
install.packages(p)
}
suppressMessages(library(p, character.only = T, warn.conflicts=FALSE))
}
setnames(DF, "name", "variable")
setnames(census_vars, "name", "variable")
join<-merge(data_from_api, census_vars, by ="variable")
View(join)
#clear memory
rm(list=ls(all=TRUE))
# load packages, install if missing
packages <- c("dplyr", "magrittr",  "censusapi","stringr","data.table","tidyverse", "tigris","tictoc")
options(tigris_use_cache = FALSE)
for(p in packages){
if(p %in% rownames(installed.packages())==FALSE){
install.packages(p)
}
suppressMessages(library(p, character.only = T, warn.conflicts=FALSE))
}
#excluding Alaska, Hawaii, American Samoa, Guam, Commonwealth of the Northern Mariana Islands, Puerto Rico, United States Virgin Islands
states<-states() %>%
as.data.frame %>%
select(c(1:3,6,7)) %>%
filter(!(STUSPS %in% c("AK",'HI','AS','GU','MP','PR','VI'))) %>%
arrange(STATEFP)
#excluding Alaska, Hawaii, American Samoa, Guam, Commonwealth of the Northern Mariana Islands, Puerto Rico, United States Virgin Islands
states<-states() %>%
as.data.frame %>%
#select(c(1:3,6,7)) %>%
filter(!(STUSPS %in% c("AK",'HI','AS','GU','MP','PR','VI'))) %>%
arrange(STATEFP)
View(states)
states<-states() %>%
as.data.frame %>%
select(c(1:3,6,7)) %>%
filter(!(STUSPS %in% c("AK",'HI','AS','GU','MP','PR','VI'))) %>%
arrange(STATEFP)
View(states)
states<-states() %>%
as.data.frame %>%
#select(c(1:3,6,7)) %>%
filter(!(STUSPS %in% c("AK",'HI','AS','GU','MP','PR','VI'))) %>%
arrange(STATEFP)
View(states)
View(states)
data(hhs_regions)
install.packages("cdcfluview")
library(cdcfluview)
data(hhs_regions)
force(hhs_regions)
View(hhs_regions)
library(tigris)
library(tigris)
states1<-states() %>%
as.data.frame %>%
select(c(1:3,6,7)) %>%
filter(!(STUSPS %in% c("AK",'HI','AS','GU','MP','PR','VI'))) %>%
arrange(STATEFP)
#install.packages("cdcfluview")
library(cdcfluview)
states2<-data(hhs_regions)
install.packages("cdcfluview")
library(cdcfluview)
states3<-data(states)
install.packages("cdcfluview")
states2<-data(hhs_regions)
states2
states3
data(hhs_regions)
#install.packages("cdcfluview")
library(cdcfluview)
data(hhs_regions)
force(hhs_regions)
View(hhs_regions)
library(cdcfluview)
states3<-data(states)
install.packages("noncensus")
library(noncensus)
install.packages("noncensus")
library(noncensus)
states3<-data(states)
install.packages("noncensus")
source('~/Desktop/test 2.R')
states2<-data(hhs_regions)
View(hhs_regions)
View(states1)
states2(states1, "state_or_terretory", "NAME") #rename for later purpose
setnames(states2, "state_or_terretory", "NAME") #rename for later purpose
states2<-data(hhs_regions) %>% as.data.frame
View(states2)
states2<-hhs_regions #%>% as.data.frame
states2<-hhs_regions %>% as.data.frame
setnames(states2, "state_or_terretory", "NAME") #rename for later purpose
colnames(states2)
setnames(states2, "state_or_territory", "NAME") #rename for later purpose
states3<-join(states1,states2)
packages <- c("dplyr","magrittr","tidyr","tidyverse","stringr","data.table","tictoc")
options(tigris_use_cache = FALSE)
for(p in packages){
if(p %in% rownames(installed.packages())==FALSE){
install.packages(p)
}
suppressMessages(library(p, character.only = T, warn.conflicts=FALSE))
}
states3<-join(states1,states2)
states3<-merge(states1,states2)
View(states3)
View(states2)
states2<-hhs_regions %>%
as.data.frame %>%
select(c("state_or_territory"))
states2<-hhs_regions %>%
as.data.frame %>%
select(state_or_territory)
states2<-hhs_regions %>%
as.data.frame %>%
select(c(2,4))
states2<-hhs_regions %>%
as.data.frame %>%
select(region_number)
states2<-hhs_regions %>%
as.data.frame %>%
select(c(region_number,state_or_territory) )
data(hhs_regions)
states2<-hhs_regions %>%
as.data.frame %>%
select(c(region_number,state_or_territory) )
View(states1)
states1<-states() %>%
as.data.frame %>%
#select(c(1:3,6,7)) %>%
filter(!(STUSPS %in% c("AK",'HI','AS','GU','MP','PR','VI'))) %>%
arrange(STATEFP)
states1<-states() %>%
as.data.frame %>%
select(c(1:3,6,7)) %>%
#select(c())
filter(!(STUSPS %in% c("AK",'HI','AS','GU','MP','PR','VI'))) %>%
arrange(STATEFP)
colnames(states1)
states1<-states() %>%
as.data.frame %>%
#select(c(1:3,6,7)) %>%
select(c(REGION,DIVISION,STATEFP,STUSPS,NAME)) %>%
filter(!(STUSPS %in% c("AK",'HI','AS','GU','MP','PR','VI'))) %>%
arrange(STATEFP)
View(states1)
?setnames
setnames(states1, c("REGION","DIVISION"), c("Census Region","DIVISION Region"))
View(states1)
states1<-states() %>%
as.data.frame %>%
select(c(REGION,DIVISION,STATEFP,STUSPS,NAME)) %>%
filter(!(STUSPS %in% c("AK",'HI','AS','GU','MP','PR','VI'))) %>%
arrange(STATEFP)
setnames(states1, c("REGION","DIVISION"), c("Census Region","Census division"))
View(states1)
states1<-states() %>%
as.data.frame %>%
select(c(REGION,DIVISION,STATEFP,STUSPS,NAME)) %>%
filter(!(STUSPS %in% c("AK",'HI','AS','GU','MP','PR','VI'))) %>%
arrange(STATEFP) %>%
setnames(., c("REGION","DIVISION"), c("Census Region","Census division"))
states1<-states() %>%
as.data.frame %>%
select(c(REGION,DIVISION,STATEFP,STUSPS,NAME)) %>%
filter(!(STUSPS %in% c("AK",'HI','AS','GU','MP','PR','VI'))) %>%
arrange(STATEFP) %>%
setnames( c("REGION","DIVISION"), c("Census Region","Census division"))
source('~/Desktop/test 2.R')
View(states1)
View(states2)
View(states3)
states<-states() %>%
as.data.frame %>%
select(c(1:3,6,7)) %>%
filter(!(STUSPS %in% c("AK",'HI','AS','GU','MP','PR','VI'))) %>%
arrange(STATEFP)
View(states)
View(states3)
apply(states3, 1, function(state){
STATEFP <- state["STATEFP"] %>% as.numeric
STUSPS<-state[4]
name<-state[5]
})
apply(states3, 1, function(state){
STATEFP <- state["STATEFP"] %>% as.numeric
#STUSPS<-state[4]
#name<-state[5]
})
apply(states3, 1, function(state){
STATEFP <- state["STATEFP"] %>% as.numeric
#STUSPS<-state[4]
name<-state["NAME"]
})
source('~/Desktop/own_code2/code/00_parent.R')
