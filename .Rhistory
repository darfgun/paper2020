str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3],
label = NULL)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL)
View(census_vars2)
string = "SEX BY AGE (WHITE ALONE)"
b<-str_extract(string, "(.*)")
b
b<-str_extract(string, "\\(.*)")
b<-str_extract(string, "\(.*)")
?gsub
?str_extract
string = "SEX BY AGE (WHITE ALONE)"
b<-str_extract(string, "\(.*)")
string = "SEX BY AGE (WHITE ALONE)"
b<-str_extract(string, "(.*)")
b
string = "SEX BY AGE (WHITE ALONE)"
b<-str_extract(string, "\\(.*)")
string = "SEX BY AGE (WHITE ALONE)"
b<-str_extract(string, "W.*)")
string = "SEX BY AGE (WHITE ALONE)"
b<-str_extract(string, "W.*")
b
b<-str_extract(string, "[:cntrl:]W.*")
b
regmatches(string, gregexpr("(?<=\\().*?(?=\\))", string, perl=T))[[1]]
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
origin = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]],
concept = NULL)
a<-regmatches(string, gregexpr("(?<=\\().*?(?=\\))", string, perl=T))[[1]]
a
strsplit(a,",")
string = "SEX BY AGE (WHITE ALONE, Hispanic)"
a<-regmatches(string, gregexpr("(?<=\\().*?(?=\\))", string, perl=T))[[1]]
a
strsplit(a,",")
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = c("PCT12A","PCT12L")) %>% select('name','label','concept')
s
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = c("PCT12L")) %>% select('name','label','concept')
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL) %>%
mutate(race)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL) %>%
mutate(race =race_his[1],
hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[2]),
race_his = NULL)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL) %>%
mutate(race =race_his[[1]],
hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[[2]]),
race_his = NULL)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL) %>%
mutate(race =race_his[[1]],
hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[2]),
race_his = NULL)
string = "SEX BY AGE (WHITE ALONE, Hispanic)"
a<-regmatches(string, gregexpr("(?<=\\().*?(?=\\))", string, perl=T))[[1]]
a
strsplit(a,",")
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = (regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","))[1],
concept = NULL) %>%
mutate(race =race_his[1],
hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[2]),
race_his = NULL)
strsplit(a,",")[[1]]
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = (regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","))[[1]],
concept = NULL) %>%
mutate(race =race_his[1],
hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[2]),
race_his = NULL)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = (regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","))[[1]],
concept = NULL) %>%
mutate(race =race_his[1],
hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[2]),
race_his = NULL)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL) #%>%
a<-regmatches(string, gregexpr("(?<=\\().*?(?=\\))", string, perl=T))[[1]]
a
strsplit(a,",")[[1]]
string = "SEX BY AGE (WHITE ALONE, Hispanic)"
a<-regmatches(string, gregexpr("(?<=\\().*?(?=\\))", string, perl=T))[[1]]
a<-strsplit(a,",")
b<-a[[1]]
a
b
class(a)
class(b)
?unlist
b<-unlist(a)
class(b)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") %>% unlist,
concept = NULL) #%>%
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") #%>% unlist
,
concept = NULL) #%>%
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") ,
concept = NULL) #%>%
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") ,
concept = NULL) %>%
mutate(race =race_his[[1]][1],
#       hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[2]),
#       race_his = NULL
)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") ,
concept = NULL) %>%
mutate(race = race_his[[1]][1],
hispanic_origin = ifelse(length(race_his[[1]]) == 1, "all", race_his[[1]][2]),
race_his = NULL
)
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = c("PCT12A")) %>% select('name','label','concept')
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") ,
concept = NULL) %>%
mutate(race = race_his[[1]][1],
hispanic_origin = ifelse(length(race_his[[1]]) == 1, "all", race_his[[1]][2]),
race_his = NULL
)
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = c("PCT12A")
) %>%
select('name','label','concept') %>%
mutate(
gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>%
as.numeric,
max_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")
%>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL,
race = race_his[[1]][1],
hispanic_origin = ifelse(length(race_his[[1]]) == 1, "all", race_his[[1]][2]),
race_his = NULL)
View(census_vars)
rm(list=ls(all=TRUE))
# load packages, install if missing
packages <- c("dplyr","magrittr", "censusapi","tidyr","tidyverse","stringr")
options(tigris_use_cache = FALSE)
for(p in packages){
if(p %in% rownames(installed.packages())==FALSE){
install.packages(p)
}
suppressMessages(library(p, character.only = T, warn.conflicts=FALSE))
}
# Add key to .Renviron
key <- "d44ca9c0b07372ada0b5243518e89adcc06651ef" #TODO
Sys.setenv(CENSUS_KEY=key)
#census api
year <-2010 #TODO delete
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = c("PCT12A")
) %>%
select('name','label','concept') %>%
mutate(
gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>%
as.numeric,
max_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")
%>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL,
race = race_his[[1]][1],
hispanic_origin = ifelse(length(race_his[[1]]) == 1, "all", race_his[[1]][2]),
race_his = NULL)
data_from_api <- getCensus(name = "dec/sf1",
vintage = 2010,
vars  = c("PCT012A164","PCT012A165"),
region = "tract:*",
regionin = "state:17") %>% #TODO testzwecke
pivot_longer( cols=!(1:3), names_to = "variable", values_to = "value")
merge(data_from_api, census_vars)
join<-merge(data_from_api, census_vars)
View(join)
setnames(DF, "name", "variable")
# load packages, install if missing
packages <- c("dplyr","magrittr", "censusapi","tidyr","tidyverse","stringr","data.table")
options(tigris_use_cache = FALSE)
for(p in packages){
if(p %in% rownames(installed.packages())==FALSE){
install.packages(p)
}
suppressMessages(library(p, character.only = T, warn.conflicts=FALSE))
}
setnames(DF, "name", "variable")
setnames(census_vars, "name", "variable")
join<-merge(data_from_api, census_vars, by ="variable")
View(join)
string = "WHITE ALONE"
substr(string,1,nchar(string)-3)
string = "WHITE ALONE"
substr(string,1,nchar(string)-6)
source('~/Desktop/own_code2/code/test.R')
source('~/Desktop/own_code2/code/test.R')
source('~/Desktop/own_code2/code/test.R')
?substr
source('~/Desktop/own_code2/code/test.R')
source('~/Desktop/own_code2/code/test.R')
source('~/Desktop/own_code2/code/test.R')
source('~/Desktop/own_code2/code/test.R')
data_from_api <- getCensus(name = "dec/sf1",
vintage = 2010,
vars  = "group(PCT12A)",
region = "tract:*",
regionin = "state:17") %>% #TODO testzwecke
pivot_longer( cols=!(1:3), names_to = "variable", values_to = "value")
data_from_api <- getCensus(name = "dec/sf1",
vintage = 2010,
vars  = "group(PCT12A)",
region = "tract:*",
regionin = "state:17") #%>% #TODO testzwecke
View(data_from_api)
#pivot_longer( cols=!(1:3), names_to = "variable", values_to = "value")
data_from_api <-pivot_longer(data_from_api, cols=!(1:3), names_to = "variable", values_to = "value")
#pivot_longer( cols=!(1:3), names_to = "variable", values_to = "value")
data_from_api <-pivot_longer(data_from_api, cols=!(1:4), names_to = "variable", values_to = "value")
data_from_api <- getCensus(name = "dec/sf1",
vintage = 2010,
#vars  = "group(PCT12A)",
vars = "PCT12A001",
region = "tract:*",
regionin = "state:17") #%>% #TODO testzwecke
View(census_vars)
data_from_api <- getCensus(name = "dec/sf1",
vintage = 2010,
#vars  = "group(PCT12A)",
vars = "PCT012A139",
region = "tract:*",
regionin = "state:17") #%>% #TODO testzwecke
#pivot_longer( cols=!(1:3), names_to = "variable", values_to = "value")
data_from_api <-pivot_longer(data_from_api, cols=!(1:4), names_to = "variable", values_to = "value")
View(data_from_api)
#pivot_longer( cols=!(1:3), names_to = "variable", values_to = "value")
data_from_api <-pivot_longer(data_from_api, cols=!c('state','county','tract','GEO_ID'), names_to = "variable", values_to = "value")
#pivot_longer( cols=!(1:3), names_to = "variable", values_to = "value")
data_from_api <-pivot_longer(data_from_api, cols=!c('state','county','tract'), names_to = "variable", values_to = "value")
data_from_api <- getCensus(name = "dec/sf1",
vintage = 2010,
#vars  = "group(PCT12A)",
vars = "c(PCT012A139,PCT012A138)",
region = "tract:*",
regionin = "state:17") #%>% #TODO testzwecke
data_from_api <- getCensus(name = "dec/sf1",
vintage = 2010,
#vars  = "group(PCT12A)",
vars = "c(PCT012A139,PCT012A134)",
region = "tract:*",
regionin = "state:17") #%>% #TODO testzwecke
data_from_api <- getCensus(name = "dec/sf1",
vintage = 2010,
#vars  = "group(PCT12A)",
vars = ",PCT012A134:PCT012A139",
region = "tract:*",
regionin = "state:17") #%>% #TODO testzwecke
data_from_api <- getCensus(name = "dec/sf1",
vintage = 2010,
#vars  = "group(PCT12A)",
vars = c("PCT012A139","PCT012A134"),
region = "tract:*",
regionin = "state:17") #%>% #TODO testzwecke
#pivot_longer( cols=!(1:3), names_to = "variable", values_to = "value")
data_from_api <-pivot_longer(data_from_api, cols=!c('state','county','tract'), names_to = "variable", values_to = "value")
data_from_api <- getCensus(name = "dec/sf1",
vintage = 2010,
vars  = "group(PCT12A)",
#vars = c("PCT012A139","PCT012A134"),
region = "tract:*",
regionin = "state:17") #%>% #TODO testzwecke
#pivot_longer( cols=!(1:3), names_to = "variable", values_to = "value")
data_from_api <-pivot_longer(data_from_api, cols=!c('state','county','tract','GEO_ID'), names_to = "variable", values_to = "value")
data_from_api[,'PCT012A001']
data_from_api[,'NAME']
#https://stackoverflow.com/questions/62063356/pivot-longer-error-impossible-to-combine-different-classes
data_from_api <-pivot_longer(data_from_api, cols=!c('state','county','tract','GEO_ID','NAME'), names_to = "variable", values_to = "value")
data_from_api <- getCensus(name = "dec/sf1",
vintage = 2010,
vars  = "group(PCT12A)",
#vars = c("PCT012A139","PCT012A134"),
region = "tract:*",
regionin = "state:17") %>%
select(!NAME)
View(census_vars)
View(data_from_api)
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = c("PCT12A", "PCT12B")
) %>%
select('name','label','concept') %>%
mutate(
gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>%
as.numeric,
max_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")
%>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL,
race = race_his[[1]][1] %>%substr(.,1,nchar(.)-6)
,
hispanic_origin = ifelse(length(race_his[[1]]) == 1, "all", race_his[[1]][2]),
race_his = NULL)
source('~/Desktop/own_code2/code/00_parent.R')
source('~/Desktop/own_code2/code/00_parent.R')
source('~/Desktop/own_code2/code/00_parent.R')
source('~/Desktop/own_code2/code/00_parent.R')
source('~/Desktop/own_code2/code/00_parent.R')
source('~/Desktop/own_code2/code/00_parent.R')
source('~/Desktop/own_code2/code/00_parent.R')
source('~/Desktop/own_code2/code/00_parent.R')
source('~/Desktop/own_code2/code/test.R')
source('~/Desktop/own_code2/code/test.R')
View(census_vars)
listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = "PCT12A"
) %>%
select('name','label','concept')
listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = "PCT12A"
) %>%
select('name','label','concept')
View(census_vars)
#TODO age, gender passt nicht
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = "PCT12A"
) %>%
select('name','label','concept') %>%
mutate(
gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% #Under 1 year, 100 to 104 years
as.numeric,
max_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")
%>% as.numeric,
#label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL,
race = race_his[[1]][1] %>%substr(.,1,nchar(.)-6)
,
hispanic_origin = ifelse(length(race_his[[1]]) == 1, "all", race_his[[1]][2]),
race_his = NULL)
View(census_vars)
