?unlist
b<-unlist(a)
class(b)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") %>% unlist,
concept = NULL) #%>%
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") #%>% unlist
,
concept = NULL) #%>%
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") ,
concept = NULL) #%>%
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") ,
concept = NULL) %>%
mutate(race =race_his[[1]][1],
#       hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[2]),
#       race_his = NULL
)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") ,
concept = NULL) %>%
mutate(race = race_his[[1]][1],
hispanic_origin = ifelse(length(race_his[[1]]) == 1, "all", race_his[[1]][2]),
race_his = NULL
)
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = c("PCT12A")) %>% select('name','label','concept')
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") ,
concept = NULL) %>%
mutate(race = race_his[[1]][1],
hispanic_origin = ifelse(length(race_his[[1]]) == 1, "all", race_his[[1]][2]),
race_his = NULL
)
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = c("PCT12A")
) %>%
select('name','label','concept') %>%
mutate(
gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>%
as.numeric,
max_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")
%>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL,
race = race_his[[1]][1],
hispanic_origin = ifelse(length(race_his[[1]]) == 1, "all", race_his[[1]][2]),
race_his = NULL)
View(census_vars)
rm(list=ls(all=TRUE))
# load packages, install if missing
packages <- c("dplyr","magrittr", "censusapi","tidyr","tidyverse","stringr")
options(tigris_use_cache = FALSE)
for(p in packages){
if(p %in% rownames(installed.packages())==FALSE){
install.packages(p)
}
suppressMessages(library(p, character.only = T, warn.conflicts=FALSE))
}
# Add key to .Renviron
key <- "d44ca9c0b07372ada0b5243518e89adcc06651ef" #TODO
Sys.setenv(CENSUS_KEY=key)
#census api
year <-2010 #TODO delete
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = c("PCT12A")
) %>%
select('name','label','concept') %>%
mutate(
gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>%
as.numeric,
max_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")
%>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL,
race = race_his[[1]][1],
hispanic_origin = ifelse(length(race_his[[1]]) == 1, "all", race_his[[1]][2]),
race_his = NULL)
data_from_api <- getCensus(name = "dec/sf1",
vintage = 2010,
vars  = c("PCT012A164","PCT012A165"),
region = "tract:*",
regionin = "state:17") %>% #TODO testzwecke
pivot_longer( cols=!(1:3), names_to = "variable", values_to = "value")
merge(data_from_api, census_vars)
join<-merge(data_from_api, census_vars)
View(join)
setnames(DF, "name", "variable")
# load packages, install if missing
packages <- c("dplyr","magrittr", "censusapi","tidyr","tidyverse","stringr","data.table")
options(tigris_use_cache = FALSE)
for(p in packages){
if(p %in% rownames(installed.packages())==FALSE){
install.packages(p)
}
suppressMessages(library(p, character.only = T, warn.conflicts=FALSE))
}
setnames(DF, "name", "variable")
setnames(census_vars, "name", "variable")
join<-merge(data_from_api, census_vars, by ="variable")
View(join)
?quit
library(dplyr)
# Step 1
data <- read.csv("https://raw.githubusercontent.com/guru99-edu/R-Programming/master/lahman-batting.csv") % > %
# Step 2
select(c(playerID, yearID, AB, teamID, lgID, G, R, HR, SH))  % > %
# Step 3
arrange(playerID, teamID, yearID)
packages <- c("dplyr","magrittr","tidyr","tidyverse","stringr","data.table","tictoc")
options(tigris_use_cache = FALSE)
for(p in packages){
if(p %in% rownames(installed.packages())==FALSE){
install.packages(p)
}
suppressMessages(library(p, character.only = T, warn.conflicts=FALSE))
}
# Step 1
data <- read.csv("https://raw.githubusercontent.com/guru99-edu/R-Programming/master/lahman-batting.csv") % > %
# Step 2
select(c(playerID, yearID, AB, teamID, lgID, G, R, HR, SH))  % > %
# Step 3
arrange(playerID, teamID, yearID)
# Step 1
data <- read.csv("https://raw.githubusercontent.com/guru99-edu/R-Programming/master/lahman-batting.csv") %>%
# Step 2
select(c(playerID, yearID, AB, teamID, lgID, G, R, HR, SH))  %>%
# Step 3
arrange(playerID, teamID, yearID)
# Structure of the data
glimpse(data)
summarise(data, mean_run =mean(R))
summarise(data, mean_games = mean(G),
mean_SH = mean(SH, na.rm = TRUE))
data %>%
group_by(lgID) %>%
summarise(mean_run = mean(HR))
source('~/Desktop/own_code2/code/test.R')
View(census_meta2)
#
census_meta2 <- census_meta %>%
group_by(year, gender, min_age, max_age, race)
View(census_meta2)
#
census_meta2 <- census_meta %>%
group_by(year, gender, min_age, max_age, race)%>%
summarise(number= n())
View(census_meta2)
#
census_meta2 <- census_meta %>%
group_by(year, gender, min_age, max_age, race)%>%
summarise(number= n(),
first = first())
View(census_meta)
#
census_meta2 <- census_meta %>%
group_by(year, gender, min_age, max_age, race)%>%
summarise(number= n(),
first = first(hispanic_origin))
#
census_meta2 <- census_meta %>%
group_by(year, gender, min_age, max_age, race)%>%
summarise(number= n(),
first = first(hispanic_origin)) %>%
filter(number = 2)
#
census_meta2 <- census_meta %>%
group_by(year, gender, min_age, max_age, race)%>%
summarise(number= n(),
first = first(hispanic_origin)) %>%
filter(number == 2)
#
census_meta2 <- census_meta %>%
group_by(year, gender, min_age, max_age, race)%>%
summarise(number= n(),
fir_var = first(variable),
fir_his = first(hispanic_origin),
las_var = last(variable),
las_his = last(hispanic_origin)
) %>%
filter(number == 2)
View(census_meta2)
View(census_meta)
#
census_meta2 <- census_meta %>%
group_by(year, gender, min_age, max_age, race)%>%
summarise(number= n(),
fir_var = list(first(variable)),
fir_his = first(hispanic_origin),
las_var = last(variable),
las_his = last(hispanic_origin)
) %>%
filter(number == 2)
#
census_meta2 <- census_meta %>%
group_by(year, gender, min_age, max_age, race)%>%
summarise(number= n(),
fir_var = list(first(variable), first(hispanic_origin)),
fir_his = first(hispanic_origin),
las_var = last(variable),
las_his = last(hispanic_origin)
) %>%
filter(number == 2)
View(census_meta2)
census_meta2$fir_var
#
census_meta2 <- census_meta %>%
group_by(year, gender, min_age, max_age, race)%>%
summarise(number= n(),
fir_var = c(first(variable), first(hispanic_origin)),
fir_his = first(hispanic_origin),
las_var = last(variable),
las_his = last(hispanic_origin)
) %>%
filter(number == 2)
census_meta2$fir_var
##---new
census_meta$downloaded <- rep("yes",nrow(census_meta))
View(census_meta)
census_meta2 <- census_meta %>%
group_by(year, gender, gender_label, min_age, max_age, race)%>% #group?
summarise(number= n(),
fir_var = first(variable),
fir_his = first(hispanic_origin),
las_var = last(variable),
las_his = last(hispanic_origin)
) %>%
filter(number == 2) %>%
apply(1, function(row){
fir_var = row["fir_var"]
#if()
})
census_meta2 <- census_meta %>%
group_by(year, gender, gender_label, min_age, max_age, race)%>% #group?
summarise(number= n(),
fir_var = first(variable),
fir_his = first(hispanic_origin),
las_var = last(variable),
las_his = last(hispanic_origin)
) %>%
filter(number == 2) %>%
apply(1, function(row){
fir_var = row["fir_var"]
print(fir_var)
#if()
})
census_meta3<-census_meta2  %>%apply(1, function(row){
#if(row["fir_var"] == )
return(row)
})
census_meta2 <- census_meta %>%
group_by(year, gender, gender_label, min_age, max_age, race)%>% #group?
summarise(number= n(),
fir_var = first(variable),
fir_his = first(hispanic_origin),
las_var = last(variable),
las_his = last(hispanic_origin)
) %>%
filter(number == 2)
census_meta3<-census_meta2  %>%apply(1, function(row){
#if(row["fir_var"] == )
return(row)
})
View(census_meta3)
census_meta3<-census_meta2  %>%apply(2, function(row){
#if(row["fir_var"] == )
return(row)
})
census_meta2 <- census_meta %>%
group_by(year, gender, gender_label, min_age, max_age, race)%>% #group?
summarise(number= n(),
fir_var = first(variable),
fir_his = first(hispanic_origin),
las_var = last(variable),
las_his = last(hispanic_origin)
) %>%
filter(number == 2,
"HISPANIC OR LATINO" %in% c(fir_his,las_his))
census_meta2 <- census_meta %>%
group_by(year, gender, gender_label, min_age, max_age, race)%>% #group?
summarise(number= n(),
fir_var = first(variable),
fir_his = first(hispanic_origin),
las_var = last(variable),
las_his = last(hispanic_origin)
) %>%
filter(number == 2,
!("HISPANIC OR LATINO" %in% c(fir_his,las_his)))
census_meta2 <- census_meta %>%
group_by(year, gender, gender_label, min_age, max_age, race)%>% #group?
summarise(number= n(),
fir_var = first(variable),
fir_his = first(hispanic_origin),
las_var = last(variable),
las_his = last(hispanic_origin)
) %>%
filter(number == 2,
!("HISPANIC OR LATINO" %in% c(fir_his,las_his)))
census_meta3<-census_meta2  %>%apply(2, function(row){
if(row["fir_his"] == "all" && row["las_his"] == "NOT HISPANIC OR LATINO"){
return(row)
}
})
census_meta3<-census_meta2  %>%apply(2, function(row){
if(row["fir_his"] == "all" && row["las_his"] == "NOT HISPANIC OR LATINO"){
return(row)
}else{
return(row)
}
})
census_meta3<-census_meta2  %>%apply(2, function(row){
print(c(row["fir_his"],row["las_his"]))
if(row["fir_his"] == "all" && row["las_his"] == "NOT HISPANIC OR LATINO"){
return(row)
}else{
return(row)
}
})
census_meta3<-census_meta2  %>%apply(2, function(row){
print(row[9])
print(c(row["fir_his"],row["las_his"]))
if(row["fir_his"] == "all" && row["las_his"] == "NOT HISPANIC OR LATINO"){
return(row)
}else{
return(row)
}
})
census_meta3<-census_meta2  %>%apply(1, function(row){
print(row[9])
print(c(row["fir_his"],row["las_his"]))
if(row["fir_his"] == "all" && row["las_his"] == "NOT HISPANIC OR LATINO"){
return(row)
}else{
return(row)
}
})
census_meta3<-census_meta2  %>%apply(1, function(row){
print(c(row["fir_his"],row["las_his"]))
if(row["fir_his"] == "all" && row["las_his"] == "NOT HISPANIC OR LATINO"){
return(row)
}else{
return(row)
}
})
c("a","b")==c("a","b")
census_meta2 <- census_meta %>%
group_by(year, gender, gender_label, min_age, max_age, race)%>% #group?
summarise(number= n(),
fir_var = first(variable),
fir_his = first(hispanic_origin),
las_var = last(variable),
las_his = last(hispanic_origin)
) %>%
filter(number == 2,
!("HISPANIC OR LATINO" %in% c(fir_his,las_his))
) %>%
mutate(
fir_var = ifelse(fir_his == "all", fir_var, las_var)
)
census_meta2 <- census_meta %>%
group_by(year, gender, gender_label, min_age, max_age, race)%>% #group?
summarise(number= n(),
fir_var = first(variable),
fir_his = first(hispanic_origin),
las_var = last(variable),
las_his = last(hispanic_origin)
) %>%
filter(number == 2,
!("HISPANIC OR LATINO" %in% c(fir_his,las_his))
) %>%
mutate(
fir_var = ifelse(fir_his != "all", fir_var, las_var)
)
View(census_meta2)
census_meta2 <- census_meta %>%
group_by(year, gender, gender_label, min_age, max_age, race)%>% #group?
summarise(number= n(),
fir_var = first(variable),
fir_his = first(hispanic_origin),
las_var = last(variable),
las_his = last(hispanic_origin)
) %>%
filter(number == 2,
!("HISPANIC OR LATINO" %in% c(fir_his,las_his))
) %>%
mutate(#swap variables if neccessary
fir_var = ifelse(fir_his == "all", fir_var, las_var),
las_var = ifelse(las_var == "HISPANIC OR LATINO", las_var, fir_var)
)
#create new data frame
census_meta2$fir_var %>%
paste0(., "C")
#create new data frame
census_meta2$fir_var %>%
paste0(., "C") %>%
cbind(.,census_meta2)
census_meta2$fir_var %>%
paste0(., "C") %>%
cbind(variable=.,census_meta2)
#create new data frame
rep(NA, 3)
##---new
census_meta$downloaded <- rep(TRUE,nrow(census_meta))
#cbind(variable=.,census_meta2)
census_meta3<-cbind(
variable=census_meta2$tot_var %>% paste0(., "C"),
year = census_meta2$year,
group = rep(NA, nrow(census_meta2)),
gender = census_meta2$gender,
gender_label = census_meta2$gender_label,
min_age = census_meta2$min_age,
max_age = census_meta2$max_age,
race = census_meta2$race,
hispanic_origin = rep("HISPANIC OR LATINO", nrow(census_meta2)),
downloaded = rep(FALSE, nrow(census_meta2)))
census_meta2 <- census_meta %>%
group_by(year, gender, gender_label, min_age, max_age, race)%>% #group?
summarise(number= n(),
tot_var = first(variable),
tot_his = first(hispanic_origin),
ntot_var = last(variable),
ntot_his = last(hispanic_origin)
) %>%
filter(number == 2,
!("HISPANIC OR LATINO" %in% c(tot_his,ntot_his))
) %>%
mutate(#swap variables if neccessary
tot_var = ifelse(tot_his == "all", tot_var, ntot_var),
ntot_var = ifelse(ntot_var == "HISPANIC OR LATINO", ntot_var, tot_var)
)
#cbind(variable=.,census_meta2)
census_meta3<-cbind(
variable=census_meta2$tot_var %>% paste0(., "C"),
year = census_meta2$year,
group = rep(NA, nrow(census_meta2)),
gender = census_meta2$gender,
gender_label = census_meta2$gender_label,
min_age = census_meta2$min_age,
max_age = census_meta2$max_age,
race = census_meta2$race,
hispanic_origin = rep("HISPANIC OR LATINO", nrow(census_meta2)),
downloaded = rep(FALSE, nrow(census_meta2)))
View(census_meta3)
census_meta4 <- rbind(census_meta,census_meta3)
source('~/Desktop/own_code2/code/00_parent.R')
runscript(script=download.cens.script, args = paste(censDir,tmpDir, year))
source('~/Desktop/own_code2/code/00_parent.R')
