data_from_api <- data_from_api%>%mutate(label2 = strsplit(label, "!!"),
min_age = label2[3],
label2 = NULL)
data_from_api <- getCensus(name = "dec/sf1",
vintage = 2010,
vars  = c("PCT012A164","PCT012A165"),
region = "tract:*",
regionin = "state:17") %>% #TODO testzwecke
pivot_longer( cols=!(1:3), names_to = "variable", values_to = "value")
#?group_by
label<-sapply(data_from_api$variable, function(variable) census_vars[census_vars[,'name']==variable,'label'])
concept<-sapply(data_from_api$variable, function(variable) census_vars[census_vars[,'name']==variable,'concept'])
data_from_api <- cbind(data_from_api, label,concept)
data_from_api2 <- data_from_api%>%mutate(label2 = strsplit(label, "!!"),
min_age = label2[[3]],
label2 = NULL)
data_from_api2 <- data_from_api%>%mutate(label2 = strsplit(label, "!!"),
min_age = label2[3],
label2 = NULL)
View(data_from_api2)
data_from_api2 <- data_from_api%>%mutate(label2 = strsplit(label, "!!"),
min_age = label2[,3],
label2 = NULL)
data_from_api2 <- data_from_api%>%mutate(label2 = strsplit(label, "!!"),
min_age = strsplit(label, "!!")[3],
label2 = NULL)
#https://stackoverflow.com/questions/39165340/dataframe-create-new-column-based-on-other-columns
data_from_api <- data_from_api%>%transform(label2 = strsplit(label, "!!"),
min_age = label2[3] %>% str_extract_all(.,pattern = "[:digit:]+")[[1]]  %>% as.numeric,
label2 = NULL)
#https://stackoverflow.com/questions/39165340/dataframe-create-new-column-based-on-other-columns
data_from_api <- data_from_api%>%mutate(label2 = strsplit(label, "!!"),
min_age = label2[3] %>% str_extract_all(.,pattern = "[:digit:]+")[[1]]  %>% as.numeric,
label2 = NULL)
data_from_api2 <- data_from_api%>%mutate(
min_age = strsplit(label, "!!")[3],
)
data_from_api2 <- data_from_api%>%mutate(
min_age = strsplit(label, "!!"),
)
data_from_api <- getCensus(name = "dec/sf1",
vintage = 2010,
vars  = c("PCT012A164","PCT012A165"),
region = "tract:*",
regionin = "state:17") %>% #TODO testzwecke
pivot_longer( cols=!(1:3), names_to = "variable", values_to = "value")
#?group_by
data_from_api$label<-sapply(data_from_api$variable, function(variable) census_vars[census_vars[,'name']==variable,'label'])
data_from_api$concept<-sapply(data_from_api$variable, function(variable) census_vars[census_vars[,'name']==variable,'concept'])
View(data_from_api2)
data_from_api2 <- data_from_api%>%mutate(
min_age = strsplit(label, "!!"),
)
string = "Total!!Female!!57 years"
strsplit(string, "!!")
c<-strsplit(string, "!!")[3]
c
c<-strsplit(string, "!!")[1]
c<-strsplit(string, "!!")[1]
c
c<-strsplit(string, "!!")[[1]]
c
c<-strsplit(string, "!!")[[1]][3]
c
data_from_api2 <- data_from_api%>%mutate(
min_age = strsplit(label, "!!")[[1]][3],
)
data_from_api2 <- data_from_api%>%transmute(
min_age = strsplit(label, "!!")[[1]][3],
)
data_from_api2 <- data_from_api%>%mutate(
min_age,max_age = strsplit(label, "!!")[[1]][3],
)
#?group_by
data_from_api$label <- with(data_from_api, census_vars[census_vars[,'name']==variable,'label'])
data_from_api2 <- data_from_api%>%mutate(
min_age = strsplit(label, "!!")[[1]][3],
max_age = strsplit(label, "!!")[[1]][3],
)
data_from_api2 <- data_from_api%>%mutate(
gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3],
max_age = strsplit(label, "!!")[[1]][3],
)
data_from_api2 <- data_from_api%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3],
max_age = strsplit(label, "!!")[[1]][3],
label = NULL,
variable = NULL)
string = "SEX BY AGE (WHITE ALONE)"
#str_extract
str_extract(string, "\(.*\)")
#str_extract
str_extract(string, "(.*)")
data_from_api2 <- data_from_api%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>% str_extract_all(pattern= "[:digit:]+")[[1]]  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3],
label = NULL,
variable = NULL)
data_from_api2 <- data_from_api%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>% str_extract_all(.,pattern= "[:digit:]+")[[1]]  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3],
label = NULL,
variable = NULL)
data_from_api2 <- data_from_api%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
#min_age = strsplit(label, "!!")[[1]][3] %>% str_extract_all(.,pattern= "[:digit:]+")[[1]]  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3],
#label = NULL,
variable = NULL)
ageg <- "57 years"
b<-str_extract_all(ageg, "[:digit:]+")[[1]]  %>% as.numeric
b
data_from_api2 <- data_from_api%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>% str_extract_all(., "[:digit:]+")[[1]]  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3],
#label = NULL,
variable = NULL)
View(census_vars)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>% str_extract_all(., "[:digit:]+")[[1]]  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3],
#label = NULL,
variable = NULL)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] ,
max_age = strsplit(label, "!!")[[1]][3])
View(census_vars2)
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = "PCT12A") %>% select('name','label','concept')
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] ,
max_age = strsplit(label, "!!")[[1]][3])
census_vars3 <-census_vars2 %>% mutate(min_age = str_extract_all(min_age, "[:digit:]+")[[1]]  %>% as.numeric)
View(census_vars3)
census_vars3 <-census_vars2 %>% mutate(min_age = str_extract_all(min_age, "[:digit:]+")[[1]]  %>% as.numeric,
max_age = str_extract_all(max_age, "[:digit:]+")[[1]]  %>% as.numeric)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] ,
max_age = strsplit(label, "!!")[[1]][3],
label = NULL)
census_vars3 <-census_vars2 %>% mutate(min_age = str_extract_all(min_age, "[:digit:]+")[[1]]  %>% as.numeric,
max_age = str_extract_all(max_age, "[:digit:]+")[[1]]  %>% as.numeric)
string = "57 years"
b<-str_extract_all(string, "[:digit:]+")[[1]]  %>% as.numeric
b
string = "57 years"
b<-str_extract_all(string, "[:digit:]+")[[1]] # %>% as.numeric
b
string = "57 years"
b<-str_extract(string, "[:digit:]+")#[[1]] # %>% as.numeric
b
b<-str_extract(string, "[:digit:]+")  %>% as.numeric
b
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3],
label = NULL)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL)
View(census_vars2)
string = "SEX BY AGE (WHITE ALONE)"
b<-str_extract(string, "(.*)")
b
b<-str_extract(string, "\\(.*)")
b<-str_extract(string, "\(.*)")
?gsub
?str_extract
string = "SEX BY AGE (WHITE ALONE)"
b<-str_extract(string, "\(.*)")
string = "SEX BY AGE (WHITE ALONE)"
b<-str_extract(string, "(.*)")
b
string = "SEX BY AGE (WHITE ALONE)"
b<-str_extract(string, "\\(.*)")
string = "SEX BY AGE (WHITE ALONE)"
b<-str_extract(string, "W.*)")
string = "SEX BY AGE (WHITE ALONE)"
b<-str_extract(string, "W.*")
b
b<-str_extract(string, "[:cntrl:]W.*")
b
regmatches(string, gregexpr("(?<=\\().*?(?=\\))", string, perl=T))[[1]]
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
origin = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]],
concept = NULL)
a<-regmatches(string, gregexpr("(?<=\\().*?(?=\\))", string, perl=T))[[1]]
a
strsplit(a,",")
string = "SEX BY AGE (WHITE ALONE, Hispanic)"
a<-regmatches(string, gregexpr("(?<=\\().*?(?=\\))", string, perl=T))[[1]]
a
strsplit(a,",")
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = c("PCT12A","PCT12L")) %>% select('name','label','concept')
s
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = c("PCT12L")) %>% select('name','label','concept')
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL) %>%
mutate(race)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL) %>%
mutate(race =race_his[1],
hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[2]),
race_his = NULL)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL) %>%
mutate(race =race_his[[1]],
hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[[2]]),
race_his = NULL)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL) %>%
mutate(race =race_his[[1]],
hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[2]),
race_his = NULL)
string = "SEX BY AGE (WHITE ALONE, Hispanic)"
a<-regmatches(string, gregexpr("(?<=\\().*?(?=\\))", string, perl=T))[[1]]
a
strsplit(a,",")
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = (regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","))[1],
concept = NULL) %>%
mutate(race =race_his[1],
hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[2]),
race_his = NULL)
strsplit(a,",")[[1]]
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = (regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","))[[1]],
concept = NULL) %>%
mutate(race =race_his[1],
hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[2]),
race_his = NULL)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = (regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","))[[1]],
concept = NULL) %>%
mutate(race =race_his[1],
hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[2]),
race_his = NULL)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL) #%>%
a<-regmatches(string, gregexpr("(?<=\\().*?(?=\\))", string, perl=T))[[1]]
a
strsplit(a,",")[[1]]
string = "SEX BY AGE (WHITE ALONE, Hispanic)"
a<-regmatches(string, gregexpr("(?<=\\().*?(?=\\))", string, perl=T))[[1]]
a<-strsplit(a,",")
b<-a[[1]]
a
b
class(a)
class(b)
?unlist
b<-unlist(a)
class(b)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") %>% unlist,
concept = NULL) #%>%
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") #%>% unlist
,
concept = NULL) #%>%
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") ,
concept = NULL) #%>%
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") ,
concept = NULL) %>%
mutate(race =race_his[[1]][1],
#       hispanic_origin = ifelse(length(race_his) == 1, "all", race_his[2]),
#       race_his = NULL
)
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") ,
concept = NULL) %>%
mutate(race = race_his[[1]][1],
hispanic_origin = ifelse(length(race_his[[1]]) == 1, "all", race_his[[1]][2]),
race_his = NULL
)
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = c("PCT12A")) %>% select('name','label','concept')
census_vars2 <- census_vars%>%mutate(gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>% as.numeric,
max_age = strsplit(label, "!!")[[1]][3]%>%
str_extract(., "[:digit:]+")  %>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,",") ,
concept = NULL) %>%
mutate(race = race_his[[1]][1],
hispanic_origin = ifelse(length(race_his[[1]]) == 1, "all", race_his[[1]][2]),
race_his = NULL
)
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = c("PCT12A")
) %>%
select('name','label','concept') %>%
mutate(
gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>%
as.numeric,
max_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")
%>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL,
race = race_his[[1]][1],
hispanic_origin = ifelse(length(race_his[[1]]) == 1, "all", race_his[[1]][2]),
race_his = NULL)
View(census_vars)
rm(list=ls(all=TRUE))
# load packages, install if missing
packages <- c("dplyr","magrittr", "censusapi","tidyr","tidyverse","stringr")
options(tigris_use_cache = FALSE)
for(p in packages){
if(p %in% rownames(installed.packages())==FALSE){
install.packages(p)
}
suppressMessages(library(p, character.only = T, warn.conflicts=FALSE))
}
# Add key to .Renviron
key <- "d44ca9c0b07372ada0b5243518e89adcc06651ef" #TODO
Sys.setenv(CENSUS_KEY=key)
#census api
year <-2010 #TODO delete
census_vars <- listCensusMetadata(
name = "dec/sf1",
vintage = 2010,
type = "variables",
group = c("PCT12A")
) %>%
select('name','label','concept') %>%
mutate(
gender = strsplit(label, "!!")[[1]][2],
gender_label = ifelse(gender == "Female", 'F', 'M'),
min_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")  %>%
as.numeric,
max_age = strsplit(label, "!!")[[1]][3] %>%
str_extract(., "[:digit:]+")
%>% as.numeric,
label = NULL,
race_his = regmatches(concept, gregexpr("(?<=\\().*?(?=\\))", concept, perl=T))[[1]] %>%
strsplit(.,","),
concept = NULL,
race = race_his[[1]][1],
hispanic_origin = ifelse(length(race_his[[1]]) == 1, "all", race_his[[1]][2]),
race_his = NULL)
data_from_api <- getCensus(name = "dec/sf1",
vintage = 2010,
vars  = c("PCT012A164","PCT012A165"),
region = "tract:*",
regionin = "state:17") %>% #TODO testzwecke
pivot_longer( cols=!(1:3), names_to = "variable", values_to = "value")
merge(data_from_api, census_vars)
join<-merge(data_from_api, census_vars)
View(join)
setnames(DF, "name", "variable")
# load packages, install if missing
packages <- c("dplyr","magrittr", "censusapi","tidyr","tidyverse","stringr","data.table")
options(tigris_use_cache = FALSE)
for(p in packages){
if(p %in% rownames(installed.packages())==FALSE){
install.packages(p)
}
suppressMessages(library(p, character.only = T, warn.conflicts=FALSE))
}
setnames(DF, "name", "variable")
setnames(census_vars, "name", "variable")
join<-merge(data_from_api, census_vars, by ="variable")
View(join)
source('~/Desktop/own_code2/code/00_parent.R')
source('~/Desktop/own_code2/code/00_parent.R')
